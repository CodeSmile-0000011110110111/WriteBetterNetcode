@startuml

!theme blueprint
hide empty description

title NetcodeStateMachine

state "Initializing" as state0
state state0 {
	state "Init Completed" as state0_trans0
	state state0_trans0 #line.dotted {
		state0_trans0 : IsNetworkManagerSingletonAssigned
		state0_trans0 : ....
		state0_trans0 : LambdaAction
	}
}
state "Offline" as state1
state state1 {
	state "Start with Relay" as state1_trans0
	state state1_trans0 #line.dotted {
		state1_trans0 : IsNetcodeRole != None
		state1_trans0 : IsRelayEnabled
		state1_trans0 : ....
		state1_trans0 : LambdaAction
	}
	state "Start w/o Relay" as state1_trans1
	state state1_trans1 #line.dotted {
		state1_trans1 : IsNetcodeRole != None
		state1_trans1 : NOT(IsRelayEnabled)
		state1_trans1 : ....
		state1_trans1 : LambdaAction
	}
}
state "RelayStarting" as state2
state state2 {
	state "Relay Alloc/Join" as state2_trans0
	state state2_trans0 #line.dotted {
		state2_trans0 : 'RelayInitOnce' == false
		state2_trans0 : ....
		state2_trans0 : 'RelayInitOnce' = true
		state2_trans0 : UnityServicesInit
		state2_trans0 : SignInAnonymously
		state2_trans0 : RelayCreateOrJoinAllocation
		state2_trans0 : ....
		state2_trans0 : ==== ""ERR -> {Offline}""
		state2_trans0 : ==== + ""ResetNetcodeState""
	}
	state "Relay Started" as state2_trans1
	state state2_trans1 #line.dotted {
		state2_trans1 : IsSignedIn
		state2_trans1 : IsRelayReady
		state2_trans1 : ....
	}
}
state "NetworkStarting" as state3
state state3 {
	state "Cancel Net Start" as state3_trans0
	state state3_trans0 #line.dotted {
		state3_trans0 : IsNetcodeRole == None
		state3_trans0 : ....
		state3_trans0 : ResetNetcodeState
	}
	state "Network Starting" as state3_trans1
	state state3_trans1 #line.dotted {
		state3_trans1 : IsNotListening
		state3_trans1 : ....
		state3_trans1 : TransportSetup
		state3_trans1 : NetworkStart
		state3_trans1 : ....
		state3_trans1 : ==== ""ERR -> {Offline}""
		state3_trans1 : ==== + ""ResetNetcodeState""
	}
	state "Server started" as state3_trans2
	state state3_trans2 #line.dotted {
		state3_trans2 : IsLocalServerStarted
		state3_trans2 : ....
	}
	state "Client started" as state3_trans3
	state state3_trans3 #line.dotted {
		state3_trans3 : IsLocalClientStarted
		state3_trans3 : ....
	}
}
state "ServerOnline" as state4
state state4 {
	state "Server stopped" as state4_trans0
	state state4_trans0 #line.dotted {
		state4_trans0 : OR(IsLocalServerStopped\n      IsNetcodeRole == None)
		state4_trans0 : ....
		state4_trans0 : NetworkStop
	}
}
state "ClientOnline" as state5
state state5 {
	state "Client connected" as state5_trans0
	state state5_trans0 #line.dotted {
		state5_trans0 : IsLocalClientConnected
		state5_trans0 : ....
	}
	state "Client stopped" as state5_trans1
	state state5_trans1 #line.dotted {
		state5_trans1 : OR(IsLocalClientStopped\n      IsNetcodeRole == None)
		state5_trans1 : ....
		state5_trans1 : NetworkStop
	}
}
state "ClientPlaying" as state6
state state6 {
	state "Client disconnected or stopped" as state6_trans0
	state state6_trans0 #line.dotted {
		state6_trans0 : OR(IsLocalClientDisconnected\n      IsLocalClientStopped\n      IsNetcodeRole == None)
		state6_trans0 : ....
		state6_trans0 : NetworkStop
	}
}
state "NetworkStopping" as state7
state state7 {
	state "Network stopped" as state7_trans0
	state state7_trans0 #line.dotted {
		state7_trans0 : IsNetworkOffline
		state7_trans0 : ....
		state7_trans0 : ResetNetcodeState
	}
}


[*] -> state0
state0 --> state1 : Init Completed
state1 --> state2 : Start with Relay
state1 --> state3 : Start w/o Relay
state2 --> state1 : ERR{Relay Alloc/Join}
state2 --> state3 : Relay Started
state3 --> state1 : Cancel Net Start
state3 --> state1 : ERR{Network Starting}
state3 --> state4 : Server started
state3 --> state5 : Client started
state4 --> state7 : Server stopped
state5 --> state6 : Client connected
state5 --> state7 : Client stopped
state6 --> state7 : Client disconnected or stopped
state7 --> state1 : Network stopped


@enduml